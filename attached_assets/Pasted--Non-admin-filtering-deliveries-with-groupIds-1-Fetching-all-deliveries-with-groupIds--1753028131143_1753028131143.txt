🚚 Non-admin filtering deliveries with groupIds: [ 1 ]

🚚 Fetching all deliveries with groupIds: [ 1 ]

4:15:09 PM [express] GET /api/orders 304 in 263ms

🚚 Deliveries returned: 0 items

📊 Query results: {

  ordersCount: '5',

  deliveriesCount: '0',

  orderStats: { pending_count: '5', total_palettes: '0', total_packages: '0' },

  deliveryStats: { total_palettes: '0', total_packages: '0' }

}

4:15:09 PM [express] GET /api/deliveries 304 in 274ms

📊 Final stats: {

  ordersCount: 5,

  deliveriesCount: 0,

  pendingOrdersCount: 5,

  averageDeliveryTime: 0,

  totalPalettes: 0,

  totalPackages: 0

}

4:15:09 PM [express] GET /api/stats/monthly 304 in 287ms

👤 PRODUCTION - User found: directeur role: directeur

🎯 getPublicities debug: {

  year: 2024,

  groupIds: undefined,

  publicityCount: 0,

  query: 'SELECT * FROM publicities WHERE year = ? ORDER BY start_date DESC'

}

🎯 getPublicities result: 0 publicités pour année 2024

4:15:09 PM [express] GET /api/publicities 304 in 297ms

DLC Stats API called with: {

  userId: '_1753012525653',

  userRole: 'directeur',

  groupIds: [ 1 ],

  storeId: undefined

}

📊 DLC Stats - groupIds: [ 1 ]

📊 DLC Stats query: 

        SELECT 

          status,

          dlc_date,

          expiry_date,

          COUNT(*) as count,

          SUM(quantity) as total_quantity,

          CASE 

            WHEN COALESCE(dlc_date, expiry_date) < CURRENT_DATE THEN 'expired'

            WHEN COALESCE(dlc_date, expiry_date) <= CURRENT_DATE + INTERVAL '15 days' THEN 'expiring_soon'

            ELSE 'active'

          END as calculated_status

        FROM dlc_products

       WHERE group_id = ANY($1) GROUP BY status, dlc_date, expiry_date, calculated_status

📊 DLC Stats params: [ [ 1 ] ]

Customer orders - User assigned stores: { groupIds: [ 1 ] }

📝 PRODUCTION - User permissions found: 0

4:15:09 PM [express] GET /api/user/permissions 304 in 279ms

📊 DLC Stats raw result: []

📊 DLC Stats final: {

  active: 0,

  expiringSoon: 0,

  expired: 0,

  valide: 0,

  en_cours: 0,

  total: 0,

  totalQuantity: 0

}

DLC Stats returned: {

  active: 0,

  expiringSoon: 0,

  expired: 0,

  valide: 0,

  en_cours: 0,

  total: 0,

  totalQuantity: 0

}

Customer orders returned from storage: 0 items

🔍 PRODUCTION AUTH DEBUG: {

  url: '/api/publicities?year=2025',

  method: 'GET',

  isAuthenticated: true,

  hasUser: true,

  userId: '_1753012525653',

  username: 'directeur',

  sessionId: 'nWwAFNCX2wKOXeTfkc8cFhkQctZkcuh0',

  hasSession: true,

  sessionData: [ 'cookie', 'passport' ],

  cookies: 'HAS_COOKIES'

}

✅ PRODUCTION AUTH: User authenticated, proceeding

4:15:09 PM [express] GET /api/dlc-products/stats 304 in 316ms

4:15:09 PM [express] GET /api/customer-orders 304 in 327ms

🎯 getPublicities debug: {

  year: 2025,

  groupIds: undefined,

  publicityCount: 1,

  query: 'SELECT * FROM publicities WHERE year = ? ORDER BY start_date DESC'

}

🎯 getPublicities result: 1 publicités pour année 2025

4:15:09 PM [express] GET /api/publicities 304 in 18ms

4:15:22 PM [express] HEAD /api/health 200 in 1ms


      
      
    