🔄 SERVER STARTUP: Initializing database...

📋 SERVER STARTUP: Dashboard messages migration should be included in database initialization

🔧 Initializing production database...

✅ Database connection successful

✅ All tables verified/created successfully

📋 INIT DATABASE: About to call runMigrations() which includes dashboard messages migration

🔄 Running database migrations...

🔧 CRITICAL FIX: Correcting deliveries status constraint...

✅ CRITICAL FIX: Deliveries status constraint corrected to allow planned status

✅ Updated name column with existing data

🔧 CRITICAL FIX: Ensuring NocoDB BL columns exist...

✅ Updated NocoDB BL column default values

🔧 CRITICAL FIX v2: Forcing tasks table completed columns for production...

📋 Current completed columns: [ { column_name: 'completed_at' }, { column_name: 'completed_by' } ]

✅ Dropped constraints

✅ Dropped old columns

✅ Added new columns

✅ Added constraints

🎉 CRITICAL FIX v2 COMPLETED. Final structure: [

  {

    column_name: 'completed_at',

    data_type: 'timestamp without time zone',

    is_nullable: 'YES'

  },

  {

    column_name: 'completed_by',

    data_type: 'character varying',

    is_nullable: 'YES'

  }

]

✅ Removed old orders_status_check constraint

✅ Added updated orders_status_check constraint

✅ ALL tables created including CRITICAL user_roles table

📋 VERIFICATION: Checking if migrateDashboardMessages function exists...

✅ VERIFICATION: migrateDashboardMessages function exists and is callable

🔄 DASHBOARD MESSAGES MIGRATION: Starting migration process...

📋 DASHBOARD MESSAGES MIGRATION: Function successfully called from runMigrations()

🔄 Running dashboard messages migration...

📋 Dashboard messages table already exists

✅ Performance indexes created for dashboard_messages

📋 Dashboard messages table structure:

  - id: integer NOT NULL DEFAULT nextval('dashboard_messages_id_seq'::regclass)

  - title: character varying NOT NULL 

  - content: text NOT NULL 

  - type: character varying NOT NULL DEFAULT 'info'::character varying

  - store_id: integer NULL 

  - created_by: character varying NOT NULL 

  - created_at: timestamp without time zone NULL DEFAULT CURRENT_TIMESTAMP

✅ Dashboard messages migration completed successfully

✅ All migrations completed successfully

✅ INIT DATABASE: runMigrations() completed successfully

✅ System user already exists

✅ Admin user exists with custom password - not resetting

🎭 Initializing roles and permissions for production...

🔒 Vérification du système de rôles fixes...

✅ Rôle fixe existe: Administrateur

✅ Rôle fixe existe: Manager

✅ Rôle fixe existe: Employé

✅ Rôle fixe existe: Directeur

✅ Nettoyage des anciens rôles système terminé - rôles fixes préservés

🔑 Assignment des permissions aux rôles fixes...

✅ Admin: 54 permissions assignées

✅ Manager: permissions assignées (tout sauf administration, avec validation livraisons)

✅ Employee: 15 permissions de base assignées

✅ Directeur: permissions assignées (tout sauf administration)

👥 Assignment des utilisateurs aux rôles fixes...

✅ admin_local assigné au rôle Administrateur

❌ Nicolas introuvable avec ID _1753182518439

✅ ff292 assigné au rôle Employé

✅ Roles already exist, checking for missing DLC permissions...

🔍 Checking for missing DLC permissions...

✅ All DLC permissions already exist

✅ Database initialization complete

✅ SERVER STARTUP: Database initialization completed successfully

✅ Migrations automatiques ignorées - base de données déjà à jour

✅ Local authentication configured

🔧 Backup service using directory: /tmp/logiflow-backups (production storage: true)

🔧 Backup service using directory: /tmp/logiflow-backups (production storage: true)

✅ Scheduler service initialized successfully with production database

📅 Services de planification prêts à être activés via l'interface

🔧 SETUP SIMPLE VERIFY - Function called, registering route /api/verify-invoices

✅ SETUP SIMPLE VERIFY - Route /api/verify-invoices registered successfully

🧪 Webhook test route registered

🚀 Services programmés initialisés et prêts à être activés

✅ Serving static files from: /app/dist/public

10:00:12 AM [express] Server running on port 3000

✅ Backup service initialized successfully

10:00:15 AM [express] HEAD /api/health 200 in 7ms


      
      
    