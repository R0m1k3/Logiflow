 
 
 
      
    nocodbTableId: 'mrr733dfb8wtt9b',

    nocodbTableName: 'CommandeF',

    invoiceColumnName: 'RefFacture',

    nocodbBlColumnName: 'Numero_BL',

    nocodbAmountColumnName: 'Montant HT',

    nocodbSupplierColumnName: 'Fournisseurs',

    webhookUrl: 'https://workflow.ffnancy.fr/webhook/acf9cbf7-040a-4cf5-a43d-80210420d30a'

  }

}

📊 [DEBUG] getNocodbConfig called with id: 1

📊 [DEBUG] Raw database result for getNocodbConfig(1): {

  id: 1,

  name: 'Nocodb',

  base_url: 'https://nocodb.ffnancy.fr',

  project_id: 'pcg4uw79ukvycxc',

  api_token: 'z4BAwLo6dgoN_E7PKJSHN7PA7kdBePtKOYcsDlwQ',

  description: '',

  is_active: true,

  created_by: 'admin_local',

  created_at: 2025-07-22T11:12:54.971Z,

  updated_at: 2025-07-25T23:07:17.197Z

}

📊 [DEBUG] Transformed NocoDB config for id 1: {

  id: 1,

  name: 'Nocodb',

  baseUrl: 'https://nocodb.ffnancy.fr',

  projectId: 'pcg4uw79ukvycxc',

  apiToken: 'z4BAwLo6dgoN_E7PKJSHN7PA7kdBePtKOYcsDlwQ',

  description: '',

  isActive: true,

  createdBy: 'admin_local',

  createdAt: 2025-07-22T11:12:54.971Z,

  updatedAt: 2025-07-25T23:07:17.197Z

}

🔍 PRODUCTION AUTH DEBUG: {

  url: '/api/verify-invoices',

  method: 'POST',

  isAuthenticated: true,

  hasUser: true,

  userId: 'admin_local',

  username: 'admin',

  sessionId: 'kkRzGqtCrhhofg6a_hPqE5GuQt035ojs',

  hasSession: true,

  sessionData: [ 'cookie', 'passport' ],

  cookies: 'HAS_COOKIES'

}

✅ PRODUCTION AUTH: User authenticated, proceeding

🔍 [VERIFY-INVOICES-CACHE] Processing 7 invoices with cache optimization

💾 [CACHE HIT] Delivery 46: Using cached result for invoice FAC2507MTX0945 (NOT FOUND)

💾 [CACHE HIT] Delivery 45: Using cached result for invoice FA 574633 (NOT FOUND)

💾 [CACHE HIT] Delivery 15: Using cached result for invoice 22529139 (EXISTS)

🔍 [SUPPLIERS-MATCH] Comparing suppliers: {

  supplier1: '"Morel"',

  supplier2: '"Morel"',

  supplier1Type: 'string',

  supplier2Type: 'string',

  supplier1Length: 5,

  supplier2Length: 5

}

🔍 [SUPPLIERS-MATCH] Normalized: {

  norm1: '"morel"',

  norm2: '"morel"',

  exactMatch: true,

  norm1IncludesNorm2: true,

  norm2IncludesNorm1: true

}

✅ [SUPPLIERS-MATCH] Exact match found

💾 [CACHE HIT] Delivery 42: Using cached result for invoice F5162713 (NOT FOUND)

💾 [CACHE HIT] Delivery 26: Using cached result for invoice F5161652 (NOT FOUND)

💾 [CACHE HIT] Delivery 16: Using cached result for invoice 223590 (NOT FOUND)

💾 [CACHE UPDATED] Delivery 36: Result cached

🔍 [VERIFY-INVOICES] Delivery 36: ✅ FOUND

✅ [VERIFY-INVOICES-CACHE] Complete: 5 cache hits, 1 NocoDB calls, 6 total results

💾 [CACHE HIT] Delivery 39: Using cached result for invoice 223604 (NOT FOUND)

✅ [VERIFY-INVOICES-CACHE] Complete: 7 cache hits, 0 NocoDB calls, 7 total results

2:13:08 PM [express] POST /api/verify-invoices 200 in 54ms

2:13:08 PM [express] POST /api/verify-invoices 200 in 32ms

🔍 PRODUCTION AUTH DEBUG: {

  url: '/api/verify-invoices',

  method: 'POST',

  isAuthenticated: true,

  hasUser: true,

  userId: 'admin_local',

  username: 'admin',

  sessionId: 'kkRzGqtCrhhofg6a_hPqE5GuQt035ojs',

  hasSession: true,

  sessionData: [ 'cookie', 'passport' ],

  cookies: 'HAS_COOKIES'

}

✅ PRODUCTION AUTH: User authenticated, proceeding

🔍 [VERIFY-INVOICES-CACHE] Processing 7 invoices with cache optimization

💾 [CACHE HIT] Delivery 46: Using cached result for invoice FAC2507MTX0945 (NOT FOUND)

💾 [CACHE HIT] Delivery 45: Using cached result for invoice FA 574633 (NOT FOUND)

💾 [CACHE HIT] Delivery 15: Using cached result for invoice 22529139 (EXISTS)

💾 [CACHE HIT] Delivery 42: Using cached result for invoice F5162713 (NOT FOUND)

💾 [CACHE HIT] Delivery 26: Using cached result for invoice F5161652 (NOT FOUND)

💾 [CACHE HIT] Delivery 16: Using cached result for invoice 223590 (NOT FOUND)

💾 [CACHE HIT] Delivery 39: Using cached result for invoice 223604 (NOT FOUND)

✅ [VERIFY-INVOICES-CACHE] Complete: 7 cache hits, 0 NocoDB calls, 7 total results

2:13:10 PM [express] POST /api/verify-invoices 200 in 12ms